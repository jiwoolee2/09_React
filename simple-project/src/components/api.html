<!DOCTYPE html>
<html>
  <head>
    <title>Google 지도 클릭 경로 표시</title>
    <meta charset="utf-8" />
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      let map;
      let startMarker = null;
      let endMarker = null;
      let directionsService;
      let directionsRenderer;

      async function initMap() {
        const { Map } = await google.maps.importLibrary("maps");
        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer();

        map = new Map(document.getElementById("map"), {
          center: { lat: 37.5665, lng: 126.9780 }, // 서울
          zoom: 13,
        });

        directionsRenderer.setMap(map);

        map.addListener("click", async (e) => {
          const clicked = e.latLng;

          if (!startMarker) {
            startMarker = new google.maps.Marker({
              position: clicked,
              map,
              label: "A",
            });
          } else if (!endMarker) {
            endMarker = new google.maps.Marker({
              position: clicked,
              map,
              label: "B",
            });

            await displayRoute(startMarker.getPosition(), endMarker.getPosition());
          } else {
            startMarker.setMap(null);
            endMarker.setMap(null);
            directionsRenderer.set("directions", null);

            startMarker = new google.maps.Marker({
              position: clicked,
              map,
              label: "A",
            });
            endMarker = null;
          }
        });
      }

      async function displayRoute(start, end) {
        try {
          const result = await directionsService.route({
            origin: start,
            destination: end,
            travelMode: google.maps.TravelMode.DRIVING,
          });
          directionsRenderer.setDirections(result);
        } catch (error) {
          console.error("Directions Error:", error);
          alert("경로를 찾을 수 없습니다.");
        }
      }

      window.initMap = initMap;
    </script>

    <!-- Google Maps JS API -->
    <script async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8xpzWGccBY9oY8SpzceZg1MBgNhQ-kig&callback=initMap&v=weekly">
    </script>
  </body>
</html>
